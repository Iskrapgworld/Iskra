<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–®–∞—Ö—Ç–∞ –ò—Å–∫—Ä—ã</title>
  <style>
    body {
      background: #111;
      color: #fff;
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    h1 {
      margin: 10px 0;
      color: #ffcc00;
    }
    #stats {
      display: flex;
      justify-content: space-around;
      margin: 10px;
      font-size: 14px;
    }
    #board {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 4px;
      width: 360px;
      margin: 10px auto;
    }
    .cell {
      width: 58px;
      height: 58px;
      border-radius: 50%;
      transition: transform 0.3s ease;
    }
    .red    { background: radial-gradient(circle, #ff4d4d, #990000); }
    .green  { background: radial-gradient(circle, #66ff66, #006600); }
    .blue   { background: radial-gradient(circle, #66ccff, #003366); }
    .purple { background: radial-gradient(circle, #dca0ff, #440066); }
    .orange { background: radial-gradient(circle, #cc9955, #cc6600); }
    #log {
      margin: 5px;
      min-height: 40px;
      font-size: 14px;
    }
    #endScreen {
      display: none;
      background: rgba(0,0,0,0.8);
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 10;
    }
    #endScreen h2 {
      color: #ff6666;
    }
    button {
      padding: 8px 20px;
      margin-top: 10px;
      background: #ffaa00;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      color: black;
    }
  </style>
</head>
<body>
  <h1>‚öíÔ∏è –®–∞—Ö—Ç–∞ –ò—Å–∫—Ä—ã</h1>
  <div id="stats">
    <div>‚ö° –ò—Å–∫—Ä–∞: <span id="energy">30</span></div>
    <div>üí® –í–æ–∑–¥—É—Ö: <span id="air">100</span>%</div>
    <div>üß± –£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ: <span id="support">100</span>%</div>
    <div>‚¨áÔ∏è –ì–ª—É–±–∏–Ω–∞: <span id="depth">0</span> –º</div>
  </div>
  <div id="log">–î–æ–±—ã—á–∞ –Ω–∞—á–∞–ª–∞—Å—å...</div>
  <div id="board"></div>
  <div id="endScreen" style="display:flex; flex-direction:column;">
    <h2>–®–∞—Ö—Ç–∞ –æ–±—Ä—É—à–∏–ª–∞—Å—å –∏–ª–∏ –≤—ã–¥–æ—Ö—Å—è –≤–æ–∑–¥—É—Ö!</h2>
    <button onclick="location.reload()">–í—ã–π—Ç–∏</button>
  </div>
  <script>
    const board = document.getElementById("board");
    const log = document.getElementById("log");
    const energyEl = document.getElementById("energy");
    const airEl = document.getElementById("air");
    const supportEl = document.getElementById("support");
    const depthEl = document.getElementById("depth");
    const endScreen = document.getElementById("endScreen");

    let grid = [], dragging = null;
    let energy = 30, air = 100, support = 100, depth = 0;

    const colors = ['red', 'green', 'blue', 'purple', 'orange'];

    function init() {
      createGrid();
      setTimeout(startTurn, 1000);
    }

    function createGrid() {
      board.innerHTML = "";
      grid = [];
      for (let i = 0; i < 36; i++) {
        const cell = document.createElement("div");
        cell.className = "cell " + colors[Math.floor(Math.random() * colors.length)];
        board.appendChild(cell);
        grid.push(cell);
      }
    }

    function index(r, c) {
      return r * 6 + c;
    }

    function getColor(el) {
      return colors.find(c => el.classList.contains(c));
    }

    function startTurn() {
      if (energy < 5 || air <= 0 || support <= 0) return endScreen.style.display = "flex";
      energy -= 5;
      energyEl.textContent = energy;
      resolveTurn();
    }

    function resolveTurn() {
      let matches = checkMatches();
      let combos = { red: 0, green: 0, blue: 0, orange: 0, purple: 0 };
      matches.forEach(g => {
        const color = getColor(grid[g[0]]);
        combos[color] += g.length;
        g.forEach(i => grid[i].className = "cell");
      });

      // –≠—Ñ—Ñ–µ–∫—Ç—ã –æ—Ç –∫–æ–º–±–∏–Ω–∞—Ü–∏–π
      if (combos.red >= 3) depth += combos.red * 2;
      if (combos.green >= 3) air += combos.green * 2;
      if (combos.blue >= 3) support += combos.blue * 2;

      air -= 10;
      support -= 5;

      // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
      air = Math.min(air, 100);
      support = Math.min(support, 100);

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
      airEl.textContent = air;
      supportEl.textContent = support;
      depthEl.textContent = depth;
      energyEl.textContent = energy;

      log.textContent = `–ö–æ–º–±–æ: ${matches.length}. –ì–ª—É–±–∂–µ –Ω–∞ ${depth}–º.`;

      dropDown();
      setTimeout(startTurn, 2000);
    }

    function checkMatches() {
      const matches = [];
      for (let r = 0; r < 6; r++) {
        for (let c = 0; c < 4; c++) {
          let i = index(r, c);
          if (getColor(grid[i]) &&
              getColor(grid[i]) === getColor(grid[i+1]) &&
              getColor(grid[i]) === getColor(grid[i+2])) {
            matches.push([i, i+1, i+2]);
          }
        }
      }
      for (let c = 0; c < 6; c++) {
        for (let r = 0; r < 4; r++) {
          let i = index(r, c);
          if (getColor(grid[i]) &&
              getColor(grid[i]) === getColor(grid[i+6]) &&
              getColor(grid[i]) === getColor(grid[i+12])) {
            matches.push([i, i+6, i+12]);
          }
        }
      }
      return matches;
    }

    function dropDown() {
      for (let c = 0; c < 6; c++) {
        for (let r = 5; r >= 0; r--) {
          let i = index(r, c);
          if (!getColor(grid[i])) {
            for (let k = r - 1; k >= 0; k--) {
              let up = index(k, c);
              if (getColor(grid[up])) {
                grid[i].className = grid[up].className;
                grid[up].className = "cell";
                break;
              }
            }
          }
        }
        for (let r = 0; r < 6; r++) {
          let i = index(r, c);
          if (!getColor(grid[i])) {
            const cls = colors[Math.floor(Math.random() * colors.length)];
            grid[i].className = "cell " + cls;
          }
        }
      }
    }

    // Drag logic (–º–æ–±–∏–ª—å–Ω—ã–π –≤–≤–æ–¥)
    board.addEventListener("touchstart", e => {
      const t = e.touches[0];
      const el = document.elementFromPoint(t.clientX, t.clientY);
      if (el && el.classList.contains("cell")) dragging = el;
    });
    board.addEventListener("touchmove", e => {
      if (!dragging) return;
      const t = e.touches[0];
      const el = document.elementFromPoint(t.clientX, t.clientY);
      if (el && el.classList.contains("cell") && el !== dragging) {
        [dragging.className, el.className] = [el.className, dragging.className];
        dragging = el;
      }
    });
    board.addEventListener("touchend", () => {
      dragging = null;
    });

    init();
  </script>
</body>
</html>
