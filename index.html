<!DOCTYPE html><html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ò–°–ö–†–ê: –®–∞—Ö—Ç–∞</title>
  <style>
    body {
      margin: 0;
      background-color: #111;
      color: #fff;
      font-family: sans-serif;
      text-align: center;
    }
    h1 {
      color: #ffa500;
      margin: 10px 0;
    }
    #topBar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 5px 10px;
      font-size: 14px;
    }
    #timerBarContainer {
      flex-grow: 1;
      height: 10px;
      margin: 0 10px;
      background: #444;
      border-radius: 5px;
      overflow: hidden;
    }
    #timerBar {
      height: 100%;
      width: 100%;
      background: linear-gradient(90deg, #33ff33, #ffff00);
      transition: width 1s linear;
    }
    #board {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 4px;
      width: 360px;
      margin: 30px auto 10px auto;
      transition: opacity 0.3s ease;
    }
    .cell {
      width: 58px;
      height: 58px;
      border-radius: 50%;
      transition: transform 0.3s ease, opacity 1s ease;
    }
    .red    { background: radial-gradient(circle, #ff4d4d, #990000); }
    .green  { background: radial-gradient(circle, #66ff66, #006600); }
    .blue   { background: radial-gradient(circle, #66ccff, #003366); }
    .purple { background: radial-gradient(circle, #dca0ff, #440066); }
    .orange { background: radial-gradient(circle, #cc9955, #cc6600); }
    .highlight { box-shadow: 0 0 10px 4px #ffffff88; }
    .fade { opacity: 0; }
    .enemy-turn #board {
      pointer-events: none;
      opacity: 0.2;
    }
    .floatText {
      position: absolute;
      font-size: 14px;
      font-weight: bold;
      pointer-events: none;
      animation: floatUp 1s ease forwards;
    }
    @keyframes floatUp {
      from { opacity: 1; transform: translateY(0); }
      to   { opacity: 0; transform: translateY(-30px); }
    }
    #modeSelect button {
      padding: 15px 30px;
      margin: 20px;
      font-size: 18px;
      border: none;
      border-radius: 12px;
      background: #ff6600;
      color: white;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>‚öí –®–∞—Ö—Ç–∞ –ò—Å–∫—Ä—ã ‚öí</h1>
  <div id="modeSelect">
    <button onclick="startMineMode()">–í –®–∞—Ö—Ç—É</button>
    <button onclick="startBattlePlaceholder()">–í –ë–æ–π (–∑–∞–≥–ª—É—à–∫–∞)</button>
  </div>
  <div id="gameArea" style="display:none">
    <div id="topBar">
      <div>
        üíé –ò—Å–∫—Ä–∞: <span id="spark">30</span><br>
        ‚ù§Ô∏è –ñ–∏–∑–Ω–∏: <span id="hp">100</span><br>
        üõ° –°–≤–æ–¥: <span id="roof">100</span><br>
        üîÆ –ú–∞–Ω–∞: <span id="mana">0</span>
      </div>
      <div id="timerBarContainer"><div id="timerBar"></div></div>
      <div>
        ü™® –ü–ª–∞—Å—Ç –ø—Ä–æ—á–Ω–æ—Å—Ç–∏: <span id="rock">150</span>
      </div>
    </div>
    <div id="board"></div>
    <div id="battleLog">–ö–æ–º–±–æ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...</div>
  </div>
<script>
// JavaScript-–ø–æ–ª–æ–≤–∏–Ω–∞ –±—É–¥–µ—Ç –¥–∞–ª—å—à–µ (—á–∞—Å—Ç—å 2)
</script>
</body>
</html>
<script>
const board = document.getElementById("board");
const battleLog = document.getElementById("battleLog");
const hpEl = document.getElementById("hp");
const shieldEl = document.getElementById("shield");
const depthEl = document.getElementById("depth");
const sparkEl = document.getElementById("spark");

let grid = [], dragging = null;
const colors = ['red', 'green', 'blue', 'orange', 'purple'];

let hp = 100;
let shield = 50;
let depth = 0;
let spark = 30;
let comboAccumulator = {};

function startMine() {
  hp = 100;
  shield = 50;
  depth = 0;
  spark = 30;
  updateStats();
  generateGridWithoutMatches();
  startTurn();
}

function updateStats() {
  hpEl.textContent = hp;
  shieldEl.textContent = shield;
  depthEl.textContent = depth;
  sparkEl.textContent = spark;
}

function generateGridWithoutMatches() {
  board.innerHTML = "";
  grid = [];

  do {
    board.innerHTML = "";
    grid = [];
    for (let i = 0; i < 36; i++) {
      const color = colors[Math.floor(Math.random() * colors.length)];
      const cell = document.createElement("div");
      cell.className = "cell " + color;
      board.appendChild(cell);
      grid.push(cell);
    }
  } while (checkMatches().length > 0);
}

function getColor(el) {
  return colors.find(c => el.classList.contains(c));
}

function index(r, c) {
  return r * 6 + c;
}

function startTurn() {
  if (spark <= 0) {
    battleLog.textContent = "–ò—Å–∫—Ä–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å!";
    return;
  }

  comboAccumulator = { red: 0, green: 0, blue: 0, orange: 0, purple: 0, count: 0 };
  board.style.pointerEvents = "auto";

  let time = 20;
  const timer = setInterval(() => {
    time--;
    if (time <= 0) {
      clearInterval(timer);
      board.style.pointerEvents = "none";
      spark -= 5;
      updateStats();
      resolveCascade();
    }
  }, 1000);
}

function resolveCascade() {
  const matches = checkMatches();
  if (matches.length === 0) {
    applyEffects();
    setTimeout(startTurn, 1000);
    return;
  }

  matches.forEach(group => {
    const color = getColor(grid[group[0]]);
    comboAccumulator[color] += group.length;
    comboAccumulator.count += 1;
    group.forEach(i => grid[i].classList.add("highlight"));
  });

  setTimeout(() => {
    matches.flat().forEach(i => {
      grid[i].classList.remove("highlight");
      grid[i].classList.add("fade");
    });

    setTimeout(() => {
      matches.flat().forEach(i => {
        const color = colors[Math.floor(Math.random() * colors.length)];
        grid[i].className = "cell " + color;
      });
      resolveCascade();
    }, 500);
  }, 1000);
}

function applyEffects() {
  const { red, green, blue, orange, purple, count } = comboAccumulator;
  const dmg = red >= 5 ? 20 : red >= 3 ? 10 : 0;
  const heal = green >= 5 ? 10 : green >= 3 ? 5 : 0;
  const def = blue >= 5 ? 10 : blue >= 3 ? 5 : 0;

  depth += dmg;
  hp += heal;
  shield += def;

  if (hp > 100) hp = 100;
  if (shield > 50) shield = 50;

  updateStats();

  battleLog.textContent = `–ö–æ–º–±–æ √ó${count}, –£—Ä–æ–Ω –ø–æ –ø–ª–∞—Å—Ç—É: ${dmg}, –õ–µ—á–µ–Ω–∏–µ: ${heal}, –ü–æ–¥–∫—Ä–µ–ø–ª–µ–Ω–∏–µ: ${def}`;
}

function checkMatches() {
  const matches = [];
  for (let r = 0; r < 6; r++) {
    for (let c = 0; c < 4; c++) {
      const i = index(r, c);
      const a = grid[i], b = grid[i + 1], c_ = grid[i + 2];
      if (getColor(a) === getColor(b) && getColor(b) === getColor(c_))
        matches.push([i, i + 1, i + 2]);
    }
  }

  for (let c = 0; c < 6; c++) {
    for (let r = 0; r < 4; r++) {
      const i = index(r, c);
      const a = grid[i], b = grid[i + 6], c_ = grid[i + 12];
      if (getColor(a) === getColor(b) && getColor(b) === getColor(c_))
        matches.push([i, i + 6, i + 12]);
    }
  }

  return matches;
}

board.addEventListener("touchstart", e => {
  const t = e.touches[0];
  const el = document.elementFromPoint(t.clientX, t.clientY);
  if (el && el.classList.contains("cell")) dragging = el;
});
board.addEventListener("touchmove", e => {
  if (!dragging) return;
  const t = e.touches[0];
  const el = document.elementFromPoint(t.clientX, t.clientY);
  if (el && el.classList.contains("cell") && el !== dragging) {
    [dragging.className, el.className] = [el.className, dragging.className];
    dragging = el;
  }
});
board.addEventListener("touchend", () => {
  dragging = null;
});
</script>
