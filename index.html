<!DOCTYPE html><html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>ИСКРА: ПВП</title>
  <style>
    body {
      background: #1a1a1a;
      color: #fff;
      font-family: sans-serif;
      text-align: center;
      margin: 0;
    }
    h1 {
      margin: 10px 0;
    }
    #scoreboard {
      display: flex;
      justify-content: space-around;
      font-size: 18px;
    }
    #board {
      width: 360px;
      height: 360px;
      margin: 20px auto;
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      grid-template-rows: repeat(6, 1fr);
      gap: 2px;
    }
    .cell {
      width: 58px;
      height: 58px;
      border-radius: 8px;
      background: gray;
    }
    .highlight {
      border: 2px solid yellow;
    }
    #overlay {
      position: absolute;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.9);
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      color: white;
      font-size: 24px;
      z-index: 10;
    }
    #timerBar {
      height: 10px;
      background: lime;
      width: 100%;
      transition: width 0.2s linear;
    }
    #startBtn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 18px;
      background: orange;
      border: none;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <h1>ИСКРА: PvP</h1>
  <div id="scoreboard">
    <div>Игрок 1: <span id="hp1">1000</span></div>
    <div>Игрок 2: <span id="hp2">1000</span></div>
  </div>
  <div id="timerBar"></div>
  <div id="board"></div>
  <div id="overlay">
    <div id="message">Ход Игрока 1</div>
    <button id="startBtn">Начать ход</button>
  </div><script>
const board = document.getElementById('board');
const hp1 = document.getElementById('hp1');
const hp2 = document.getElementById('hp2');
const overlay = document.getElementById('overlay');
const message = document.getElementById('message');
const startBtn = document.getElementById('startBtn');
const timerBar = document.getElementById('timerBar');

let currentPlayer = 1;
let hp = {1: 1000, 2: 1000};
let grid = [];
let dragging = null;
let timeLimit = 20000;
let timer, timerStart;

function initGrid() {
  grid = [];
  board.innerHTML = '';
  const colors = ['#f00', '#0f0', '#00f', '#ff0', '#0ff'];
  for (let i = 0; i < 36; i++) {
    const div = document.createElement('div');
    div.className = 'cell';
    div.style.background = colors[Math.floor(Math.random()*colors.length)];
    board.appendChild(div);
    grid.push(div);
  }
}

function index(row, col) {
  return row * 6 + col;
}

function checkMatches() {
  let match = [];
  for (let r = 0; r < 6; r++) {
    for (let c = 0; c < 4; c++) {
      let i = index(r,c);
      let c1 = grid[i].style.background;
      let c2 = grid[i+1].style.background;
      let c3 = grid[i+2].style.background;
      if (c1 === c2 && c2 === c3) match.push(i,i+1,i+2);
    }
  }
  for (let c = 0; c < 6; c++) {
    for (let r = 0; r < 4; r++) {
      let i = index(r,c);
      let c1 = grid[i].style.background;
      let c2 = grid[i+6].style.background;
      let c3 = grid[i+12].style.background;
      if (c1 === c2 && c2 === c3) match.push(i,i+6,i+12);
    }
  }
  return [...new Set(match)];
}

function applyMatches(match) {
  match.forEach(i => grid[i].style.background = '');
  for (let c = 0; c < 6; c++) {
    for (let r = 5; r >= 0; r--) {
      let i = index(r,c);
      if (grid[i].style.background === '') {
        for (let k = r - 1; k >= 0; k--) {
          let j = index(k,c);
          if (grid[j].style.background !== '') {
            grid[i].style.background = grid[j].style.background;
            grid[j].style.background = '';
            break;
          }
        }
        if (grid[i].style.background === '') {
          let colors = ['#f00','#0f0','#00f','#ff0','#0ff'];
          grid[i].style.background = colors[Math.floor(Math.random()*colors.length)];
        }
      }
    }
  }
}

function startTurn() {
  overlay.style.display = 'none';
  let remaining = timeLimit;
  timerStart = Date.now();
  timerBar.style.width = '100%';
  timer = setInterval(() => {
    let elapsed = Date.now() - timerStart;
    let percent = Math.max(0, 100 - (elapsed / timeLimit * 100));
    timerBar.style.width = percent + '%';
    if (elapsed >= timeLimit) {
      clearInterval(timer);
      finishTurn();
    }
  }, 100);
}

function finishTurn() {
  let match = checkMatches();
  let damage = match.length * 10;
  let target = currentPlayer === 1 ? 2 : 1;
  hp[target] -= damage;
  if (hp[target] < 0) hp[target] = 0;
  hp1.textContent = hp[1];
  hp2.textContent = hp[2];
  applyMatches(match);
  currentPlayer = target;
  message.textContent = `Ход Игрока ${currentPlayer}`;
  overlay.style.display = 'flex';
}

board.addEventListener('touchstart', e => {
  if (overlay.style.display !== 'none') return;
  let t = e.touches[0];
  let el = document.elementFromPoint(t.clientX, t.clientY);
  if (el && el.classList.contains('cell')) dragging = el;
}, {passive: false});

board.addEventListener('touchmove', e => {
  if (!dragging) return;
  e.preventDefault();
  let t = e.touches[0];
  let el = document.elementFromPoint(t.clientX, t.clientY);
  if (el && el.classList.contains('cell') && el !== dragging) {
    [dragging.style.background, el.style.background] = [el.style.background, dragging.style.background];
    dragging = el;
  }
}, {passive: false});

board.addEventListener('touchend', () => {
  if (timer) clearInterval(timer);
  finishTurn();
});

startBtn.addEventListener('click', startTurn);

initGrid();
</script></body>
</html>
