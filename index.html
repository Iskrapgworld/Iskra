<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ò–°–ö–†–ê: –®–∞—Ö—Ç–∞</title>
  <style>
    body {
      margin: 0;
      background: #111;
      color: #fff;
      font-family: sans-serif;
      text-align: center;
    }
    h1 { color: #66ccff; margin: 10px 0; }
    #topBar {
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 5px;
    }
    #stabilityBarContainer {
      width: 200px;
      height: 12px;
      background: #333;
      border-radius: 6px;
      overflow: hidden;
    }
    #stabilityBar {
      height: 100%;
      width: 100%;
      background: linear-gradient(to right, green, yellow, red);
      transition: width 0.5s ease;
    }
    #board {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 4px;
      width: 360px;
      margin: 20px auto;
    }
    .cell {
      width: 58px;
      height: 58px;
      border-radius: 8px;
    }
    .red    { background: #aa3333; }
    .green  { background: #33aa33; }
    .blue   { background: #3399cc; }
    .orange { background: #ffaa33; }
    .purple { background: #9933cc; }
    #log {
      margin-top: 10px;
      font-size: 14px;
    }
    .floatText {
      position: absolute;
      font-weight: bold;
      color: white;
      animation: floatUp 1s ease forwards;
    }
    @keyframes floatUp {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(-30px); }
    }
  </style>
</head>
<body>
  <h1>–®–∞—Ö—Ç–∞ –ò—Å–∫—Ä—ã</h1>
  <div id="topBar">
    <div>‚ö° –ò—Å–∫—Ä–∞: <span id="energy">1000</span></div>
    <div>
      –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å:
      <div id="stabilityBarContainer">
        <div id="stabilityBar"></div>
      </div>
    </div>
    <div>‚õè –ì–ª—É–±–∏–Ω–∞: <span id="depth">0</span></div>
  </div>
  <div id="board"></div>
  <div id="log">–°–æ–±–∏—Ä–∞–π –∫—Ä–∏—Å—Ç–∞–ª–ª—ã, —É–∫—Ä–µ–ø–ª—è–π —à–∞—Ö—Ç—É!</div>

  <script>
    const board = document.getElementById("board");
    const energyEl = document.getElementById("energy");
    const depthEl = document.getElementById("depth");
    const stabilityBar = document.getElementById("stabilityBar");
    const log = document.getElementById("log");

    let grid = [];
    let dragging = null;
    let energy = 1000;
    let depth = 0;
    let stability = 100; // –ø—Ä–æ—Ü–µ–Ω—Ç—ã

    const colors = ["red", "green", "blue", "orange", "purple"];

    function createGrid() {
      board.innerHTML = "";
      grid = [];
      for (let i = 0; i < 36; i++) {
        const cell = document.createElement("div");
        cell.className = "cell " + colors[Math.floor(Math.random() * colors.length)];
        board.appendChild(cell);
        grid.push(cell);
      }
    }

    function updateUI() {
      energyEl.textContent = energy;
      depthEl.textContent = depth;
      stabilityBar.style.width = stability + "%";
      if (stability > 60) stabilityBar.style.background = "green";
      else if (stability > 30) stabilityBar.style.background = "orange";
      else stabilityBar.style.background = "red";
    }

    function checkMatches() {
      const matches = [];
      for (let r = 0; r < 6; r++) {
        for (let c = 0; c < 4; c++) {
          const i = r * 6 + c;
          const a = grid[i], b = grid[i + 1], c_ = grid[i + 2];
          if (a && b && c_ && a.className === b.className && b.className === c_.className) {
            matches.push([i, i + 1, i + 2]);
          }
        }
      }
      return matches;
    }

    function resolveTurn() {
      if (energy < 5) {
        log.textContent = "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏—Å–∫—Ä—ã!";
        return;
      }

      energy -= 5;

      const matches = checkMatches();
      if (matches.length === 0) {
        log.textContent = "–ù–µ—Ç –∫–æ–º–±–∏–Ω–∞—Ü–∏–π.";
        stability -= 10;
        if (stability <= 0) {
          log.textContent = "üí• –û–±–≤–∞–ª —à–∞—Ö—Ç—ã! –ü–æ—Ç–µ—Ä—è–Ω–∞ —á–∞—Å—Ç—å —Ä–µ—Å—É—Ä—Å–æ–≤.";
          depth = Math.floor(depth / 2);
          stability = 100;
        }
        updateUI();
        return;
      }

      let red = 0, green = 0, blue = 0, orange = 0, purple = 0;
      matches.forEach(group => {
        const color = colors.find(c => grid[group[0]].classList.contains(c));
        group.forEach(i => {
          grid[i].className = "cell";
        });
        if (color === "red") red += group.length;
        if (color === "green") green += group.length;
        if (color === "blue") blue += group.length;
        if (color === "orange") orange += group.length;
        if (color === "purple") purple += group.length;
      });

      depth += red;
      stability += blue * 3;
      if (stability > 100) stability = 100;

      log.textContent = `‚öí –£—Ä–æ–Ω: ${red}, üíö –õ–µ—á–µ–Ω–∏–µ: ${green}, üõ° –£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ: ${blue}`;
      createGrid();
      updateUI();
    }

    board.addEventListener("click", resolveTurn);

    createGrid();
    updateUI();

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É—Ö—É–¥—à–µ–Ω–∏–µ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏
    setInterval(() => {
      stability -= 10;
      if (stability <= 0) {
        log.textContent = "üí• –û–±–≤–∞–ª —à–∞—Ö—Ç—ã!";
        stability = 100;
        depth = Math.floor(depth / 2);
      }
      updateUI();
    }, 20000);
  </script>
</body>
</html>
