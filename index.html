<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>üî• –ò–°–ö–†–ê: –ë–∏—Ç–≤–∞ v1.5.4</title>
  <style>
    body {
      margin: 0;
      background: #111;
      color: #fff;
      font-family: sans-serif;
      overflow: hidden;
    }

    #overlay, #endScreen, #mainMenu, #charMenu {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: #000c;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 10;
    }

    input, button {
      padding: 10px;
      font-size: 18px;
      margin: 10px;
      border: none;
      border-radius: 5px;
    }

    button {
      background: #7b2eff;
      color: #fff;
    }

    #board {
      display: grid;
      grid-template-columns: repeat(6, 60px);
      grid-template-rows: repeat(6, 60px);
      gap: 2px;
      margin: 20px auto;
      width: 360px;
      height: 360px;
      pointer-events: auto;
    }

    .cell {
      width: 60px;
      height: 60px;
      border-radius: 10px;
      background: gray;
      transition: background 0.3s;
    }

    .red { background: #d62828; }
    .green { background: #4caf50; }
    .blue { background: #2196f3; }
    .purple { background: #9c27b0; }
    .orange { background: #ff9800; }

    .highlight {
      box-shadow: 0 0 10px 3px yellow;
    }

    .fade {
      opacity: 0;
      transition: opacity 0.6s;
    }

    .floatText {
      position: absolute;
      font-size: 18px;
      font-weight: bold;
      pointer-events: none;
      animation: floatUp 1.5s ease-out forwards;
      z-index: 99;
    }

    @keyframes floatUp {
      0% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-40px); }
    }

    .enemy-turn #board {
      opacity: 0.3;
    }

    #battleLog {
      text-align: center;
      font-size: 18px;
      margin-top: 10px;
      height: 30px;
    }

    #topBar {
      display: flex;
      justify-content: space-between;
      margin: 10px 20px 0 20px;
    }

    .statBlock {
      text-align: left;
      font-size: 16px;
    }

    .statBlock span {
      display: block;
    }

    #lightningBtn {
      position: absolute;
      right: 20px;
      bottom: 20px;
      background: #ffcc00;
      color: #000;
      font-weight: bold;
      display: none;
    }

    #timerBar {
      height: 6px;
      background: lime;
      margin: 5px 20px;
      border-radius: 3px;
      transition: width 1s linear;
    }
  </style>
</head>
<body>
  <div id="overlay">
    <h2>–í–≤–µ–¥–∏—Ç–µ –∏–º—è:</h2>
    <input id="nameInput" placeholder="–í–∞—à–µ –∏–º—è" />
    <button id="startBtn">–î–∞–ª–µ–µ</button>
  </div>

  <div id="mainMenu" style="display:none;">
    <h1>üî• –ò–°–ö–†–ê: –ë–∏—Ç–≤–∞ v1.5.4 üî•</h1>
    <button onclick="startGame()">–í –±–æ–π!</button>
    <button onclick="showCharacterMenu()">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</button>
  </div>

  <div id="charMenu" style="display:none;">
    <h2>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã</h2>
    <div>–ò—Å–∫—Ä–∞: <span id="xpEl">0</span></div>
    <div>–û—á–∫–∏ –Ω–∞–≤—ã–∫–æ–≤: <span id="skillPointsEl">0</span></div>
    <div>–°–∏–ª–∞: <span id="strEl">0</span> <button onclick="upgrade('str')">+</button></div>
    <div>–õ–æ–≤–∫–æ—Å—Ç—å: <span id="agiEl">0</span> <button onclick="upgrade('agi')">+</button></div>
    <div>–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç: <span id="intEl">0</span> <button onclick="upgrade('int')">+</button></div>
    <div>–ñ–∏–≤—É—á–µ—Å—Ç—å: <span id="vitEl">0</span> <button onclick="upgrade('vit')">+</button></div>
    <div>–£–¥–∞—á–∞: <span id="luckEl">0</span> <button onclick="upgrade('luck')">+</button></div>
    <button onclick="backToMenu()">–ù–∞–∑–∞–¥</button>
  </div>

  <div id="endScreen" style="display:none;">
    <h2 id="endMessage">–ü–æ–±–µ–¥–∞!</h2>
    <button onclick="showMainMenu()">–í –º–µ–Ω—é</button>
  </div>

  <div id="topBar">
    <div class="statBlock">
      –í—ã:
      <span id="hpEl">200</span> ‚ù§Ô∏è
      <span id="shieldEl">100</span> üõ°
      <span id="manaEl">0</span> üîÆ
    </div>
    <div class="statBlock">
      –ú–æ–Ω—Å—Ç—Ä:
      <span id="enemyHpEl">100</span> üíÄ
      <span id="enemyShieldEl">100</span> üõ°
      <span id="enemyManaEl">0</span> üîÆ
    </div>
  </div>

  <div id="timerBar"></div>
  <div id="battleLog">–ö–æ–º–±–æ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...</div>
  <div id="board"></div>
  <button id="lightningBtn" onclick="useLightning()">‚ö° –ú–æ–ª–Ω–∏—è</button>

  <script>
    let grid = [];
    let dragging = null;
let isPlayerTurn = true;
let hp = 200, shield = 100, mana = 0;
let enemyHp = 100, enemyShield = 100, enemyMana = 0;
let lightningUsed = false;
let comboAccumulator = {};
let playerName = "–ò–≥—Ä–æ–∫", turnTimer;

function showMainMenu() {
  const name = document.getElementById("nickname").value.trim();
  if (name) playerName = name;
  overlay.style.display = "none";
  mainMenu.style.display = "flex";
  endScreen.style.display = "none";
}
    function startGame() {
  hp = 200; shield = 100; mana = 0;
  enemyHp = 100; enemyShield = 100; enemyMana = 0;
  lightningUsed = false;
  updateStats();
  createGridWithoutCombos();
  endScreen.style.display = "none";
  mainMenu.style.display = "none";
  document.body.classList.remove("enemy-turn");
  isPlayerTurn = true;
  lightningBtn.style.display = "none";
  startTurn();
}

function updateStats() {
  hpEl.textContent = hp;
  shieldEl.textContent = shield;
  manaEl.textContent = mana;
  enemyHpEl.textContent = enemyHp;
  enemyShieldEl.textContent = enemyShield;
  enemyManaEl.textContent = enemyMana;
}
    function createGridWithoutCombos() {
  let attempts = 0;
  do {
    board.innerHTML = "";
    grid = [];
    for (let i = 0; i < 36; i++) {
      const color = colors[Math.floor(Math.random() * colors.length)];
      const cell = document.createElement("div");
      cell.className = "cell " + color;
      board.appendChild(cell);
      grid.push(cell);
    }
    attempts++;
    if (attempts > 100) break; // –∑–∞—â–∏—Ç–∞ –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
  } while (checkMatches().length > 0);
    }
    function startTurn() {
  isPlayerTurn = true;
  lightningUsed = false;
  comboAccumulator = { red: 0, green: 0, blue: 0, orange: 0, purple: 0, count: 0 };
  document.body.classList.remove("enemy-turn");
  board.style.pointerEvents = "auto";
  lightningBtn.style.display = mana >= 20 ? "inline-block" : "none";

  let time = 20;
  timerBar.style.width = "100%";
  clearInterval(turnTimer);
  turnTimer = setInterval(() => {
    time--;
    timerBar.style.width = (time * 5) + "%";
    if (time <= 0) {
      clearInterval(turnTimer);
      board.style.pointerEvents = "none";
      resolveCascade();
    }
  }, 1000);
    }
    board.addEventListener("touchend", () => {
  if (!isPlayerTurn) return;
  clearInterval(turnTimer);
  board.style.pointerEvents = "none";
  resolveCascade();
});
    
