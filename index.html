<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ò–°–ö–†–ê: –ë–∏—Ç–≤–∞</title>
  <style>
    body {
      background-color: #1e1e1e;
      font-family: sans-serif;
      color: #fff;
      text-align: center;
      margin: 0;
      padding: 0;
    }

    h1 {
      color: #ffcc66;
      margin: 20px 0;
    }

    #scoreboard {
      display: flex;
      justify-content: space-around;
      margin-bottom: 10px;
      font-size: 18px;
    }

    #timerBar {
      width: 80%;
      height: 10px;
      background: #444;
      margin: 10px auto;
      border-radius: 5px;
      overflow: hidden;
    }

    #timerProgress {
      height: 100%;
      background: #ffcc66;
      width: 100%;
      transition: width 4s linear;
    }

    #grid {
      display: grid;
      grid-template-columns: repeat(6, 60px);
      grid-gap: 4px;
      justify-content: center;
      margin: 20px auto;
    }

    .cell {
      width: 60px;
      height: 60px;
    }

    .gem {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      box-shadow: inset -3px -3px 6px rgba(0, 0, 0, 0.3),
                  inset 3px 3px 6px rgba(255, 255, 255, 0.2);
    }

    .red {
      background: radial-gradient(circle at 30% 30%, #ff5e5e, #8b0000);
      clip-path: ellipse(45% 55% at 50% 45%);
    }

    .red::after {
      content: '';
      position: absolute;
      width: 25px;
      height: 2px;
      background: #400;
      bottom: 18px;
      left: 18px;
      transform: rotate(-20deg);
      opacity: 0.6;
    }

    .green {
      background: radial-gradient(circle at 30% 30%, #7fff7f, #228b22);
    }

    .blue {
      background: linear-gradient(135deg, #66ccff, #003366);
      clip-path: polygon(50% 0%, 100% 25%, 80% 100%, 20% 100%, 0% 25%);
    }

    .yellow {
      background: radial-gradient(circle at 30% 30%, #ffff88, #ffaa00);
      box-shadow: 0 0 15px 5px rgba(255, 200, 0, 0.5);
    }

    .purple {
      background: radial-gradient(circle at 30% 30%, #dca0ff, #440066);
      clip-path: polygon(50% 0%, 100% 20%, 90% 100%, 20% 90%, 0% 30%);
    }
  </style>
</head>
<body>
  <h1>–ò–°–ö–†–ê: –ë–∏—Ç–≤–∞</h1>
  <div id="scoreboard">
    <div>‚ù§Ô∏è –ò–≥—Ä–æ–∫: <span id="playerHP">100</span></div>
    <div>üíÄ –í—Ä–∞–≥: <span id="enemyHP">100</span></div>
  </div>
  <div id="timerBar"><div id="timerProgress"></div></div>
  <div id="grid"></div>
  <script>
    const grid = document.getElementById("grid");
    const gemTypes = ["red", "green", "blue", "yellow", "purple"];
    let selected = null;
    let playerHP = 100;
    let enemyHP = 100;

    function createGem(type) {
      const cell = document.createElement("div");
      cell.className = "cell";
      const gem = document.createElement("div");
      gem.className = "gem " + type;
      gem.setAttribute("draggable", true);
      cell.appendChild(gem);
      addDragHandlers(gem);
      return cell;
    }

    function fillGrid() {
      grid.innerHTML = "";
      for (let i = 0; i < 36; i++) {
        const type = gemTypes[Math.floor(Math.random() * gemTypes.length)];
        grid.appendChild(createGem(type));
      }
    }

    function addDragHandlers(elem) {
      elem.addEventListener("dragstart", e => {
        selected = e.target;
      });

      elem.addEventListener("dragover", e => e.preventDefault());

      elem.addEventListener("drop", e => {
        e.preventDefault();
        if (!selected || selected === e.target) return;

        const parent1 = selected.parentNode;
        const parent2 = e.target.parentNode;
        parent1.appendChild(e.target);
        parent2.appendChild(selected);

        checkMatches();
      });
    }

    function checkMatches() {
      const gems = Array.from(document.querySelectorAll(".cell .gem"));
      let matchFound = false;
      let redCount = 0;
      let greenCount = 0;

      for (let i = 0; i < 36; i++) {
        const row = Math.floor(i / 6);
        const col = i % 6;

        if (col < 4) {
          const g1 = gems[i];
          const g2 = gems[i + 1];
          const g3 = gems[i + 2];
          if (g1 && g2 && g3 && g1.className === g2.className && g1.className === g3.className) {
            matchFound = true;
            const type = g1.classList[1];
            if (type === "red") redCount += 3;
            if (type === "green") greenCount += 3;
          }
        }

        if (row < 4) {
          const g1 = gems[i];
          const g2 = gems[i + 6];
          const g3 = gems[i + 12];
          if (g1 && g2 && g3 && g1.className === g2.className && g1.className === g3.className) {
            matchFound = true;
            const type = g1.classList[1];
            if (type === "red") redCount += 3;
            if (type === "green") greenCount += 3;
          }
        }
      }

      if (matchFound) {
        if (redCount >= 5) {
          enemyHP -= 20;
        } else if (redCount > 0) {
          enemyHP -= 10;
        }

        if (greenCount >= 5) {
          playerHP += 20;
        } else if (greenCount > 0) {
          playerHP += 10;
        }

        updateHP();
        setTimeout(fillGrid, 300);
      }
    }

    function updateHP() {
      if (playerHP > 100) playerHP = 100;
      if (enemyHP > 100) enemyHP = 100;
      if (enemyHP <= 0) {
        alert("–ü–æ–±–µ–¥–∞! –ù–æ–≤—ã–π –≤—Ä–∞–≥ —Å–∏–ª—å–Ω–µ–µ...");
        enemyHP = 100;
      }
      if (playerHP <= 0) {
        alert("–ü–æ—Ä–∞–∂–µ–Ω–∏–µ! –ü–æ—Ç–µ—Ä—è–Ω–∞ —á–∞—Å—Ç—å –ò—Å–∫—Ä—ã...");
        playerHP = 100;
      }
      document.getElementById("playerHP").textContent = playerHP;
      document.getElementById("enemyHP").textContent = enemyHP;
    }

    function startTimer() {
      const bar = document.getElementById("timerProgress");
      bar.style.transition = "none";
      bar.style.width = "100%";
      setTimeout(() => {
        bar.style.transition = "width 4s linear";
        bar.style.width = "0%";
      }, 10);
    }

    function nextTurn() {
      startTimer();
      setTimeout(() => {
        nextTurn();
      }, 4000);
    }

    fillGrid();
    startTimer();
    nextTurn();
  </script>
</body>
</html>
